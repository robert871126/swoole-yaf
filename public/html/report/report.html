<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="renderer" content="webkit">
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<title>微校邦-资讯管理</title>
	<meta name="keywords" content="">
	<meta name="description" content="">

	<link rel="shortcut icon" href="favicon.ico">
	<link href="/statics/css/bootstrap.min.css?v=3.3.5" rel="stylesheet">
	<link href="/statics/css/font-awesome.min.css?v=4.4.0" rel="stylesheet">
	<link href="/statics/css/animate.min.css" rel="stylesheet">
	<link href="/statics/css/style.min.css?v=4.0.0" rel="stylesheet">
	<link href="/statics/css/custom.css" rel="stylesheet">

	<script src="/statics/js/jquery.min.js?v=2.1.4"></script>
	<script src="/statics/js/common.js"></script>
	<script src="/statics/js/plugins/layer/laytpl/laytpl.js"></script>
	<script src="/statics/js/plugins/layer/laypage/laypage.js"></script>
</head>

<body class="gray-bg">
	<div class="wrapper wrapper-content  animated fadeInRight blog">
		<div class="row">
			<div class="col-md-12">
				<div class="search-box">
					<div class="search-box-left">
						<div class="input-group">
	                        <input type="text" class="form-control" name="keywords"> <span class="input-group-btn"> <button type="button" class="btn btn-primary search">搜索
	                        </button> </span>
	                    </div>
						<select class="form-control" name="report_type" onchange="setParam()">
	                        <option value="-1">举报类别</option>
	                        <option value="0">泄露隐私</option>
	                        <option value="1">人身攻击</option>
	                        <option value="2">淫秽色情</option>
	                        <option value="3">垃圾广告</option>
	                        <option value="4">敏感信息</option>
	                        <option value="5">其他</option>
	                    </select>
					</div>
				</div>
				<div class="ibox">
					<div class="ibox-content">
						<table class="table table-bordered table-striped table-hover">
							<thead>
								<tr>
									<th width="30"><input type="checkbox"  class="i-checks" id="checkAll" name="input[]"></th>
									<th>资讯标题</th>
									<th>举报评论</th>
									<th nowrap="nowrap">举报类型</th>
									<th nowrap="nowrap">被举报者</th>
									<th nowrap="nowrap">被举报者手机号</th>
									<th nowrap="nowrap">举报者</th>
									<th nowrap="nowrap">举报者手机号</th>
									<th nowrap="nowrap">举报时间</th>
									<th nowrap="nowrap">操作</th>
								</tr>
							</thead>
							<tbody id="listBox">
								<tr>
									<td colspan="10">
										<div class="loading"></div>
									</td>
								</tr>
							</tbody>
							<script type="html/text" id="artList">
								{{# for(var i = 0, len = d.list.length; i < len; i++){ }}
								    <tr>
										<td>
											<input type="checkbox" class="i-checks" name="checkbox" value="{{ d.list[i].comment_id }}" data-reportid = "{{ d.list[i].report_id }}">
										</td>
										<td><a href="/html-article-detail.html?id={{ d.list[i].info_id }}"  class="J_menuItem">{{ d.list[i].title }}</a></td>
										<td><a href="/html-article-detail.html?id={{ d.list[i].info_id }}"  class="J_menuItem">{{ d.list[i].content }}</a></td>
										<td nowrap="nowrap">{{ d.list[i].report_type }}</td>
										<td nowrap="nowrap">{{ d.list[i].rec_true_name }}</td>
										<td nowrap="nowrap">{{ d.list[i].rec_phone }}</td>
										<td nowrap="nowrap">{{ d.list[i].true_name }}</td>
										<td nowrap="nowrap">{{ d.list[i].phone }}</td>
										<td nowrap="nowrap">{{ d.list[i].report_time }}</td>
										<td nowrap="nowrap">
											<a href="javascript:;" class="warning reject" data-reportid="{{ d.list[i].report_id }}"><i class="fa fa-minus-circle"></i>驳回举报</a> | 
											<a href="javascript:;" class="danger delete" data-commentid="{{ d.list[i].comment_id }}" data-reportid={{ d.list[i].report_id }}><i class="fa fa-close"></i>删除评论</a>

										</td>
									</tr>
								{{# } }}
							</script>
						</table>
						<div class="button-box">
							<button type="button" class="btn btn-danger multiple-delete">
								<i class="fa fa-close"></i>批量删除评论
							</button>
							<div class="page f_r" id="page"></div>
							<div class="f_r count" id="count"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script src="/statics/js/jquery.min.js?v=2.1.4"></script>
	<script src="/statics/js/bootstrap.min.js?v=3.3.5"></script>
	<script src="/statics/js/content.min.js?v=1.0.0"></script>
	<script src="/statics/js/common.js"></script>
	<script>
		$(function () {
			$(".search").on("click", function () {
				setParam();
			});
			$("input[name='keywords']").on("keypress", function (e) {
				if(e.keyCode == 13) {
					setParam();
				}
			});

			// 驳回举报
			$("table").on("click", ".reject", function () {
				var reportid = $(this).data('reportid');
				var param = {report_id: reportid};
				$.deleteNode("Report/reject", param, '确定要驳回吗？', function (data) {
					if(data.status == 1){
						setParam();
					} else {
						layer.alert(data.msg);
						return false;
					}
				});
			});

			// 单个删除
			$("table").on("click", ".delete", function () {
				var commentid = $(this).data("commentid");
				var reportid = $(this).data('reportid');
				var param = {report_id: reportid,comment_id: commentid};
				$.deleteNode("Report/delete", param, '确定要删除此条评论吗？', function (data) {
					if(data.status == 1){
						setParam();
					} else {
						layer.alert(data.msg);
						return false;
					}
				});
			});
			// 多个删除
			$(".multiple-delete").on("click", function () {
				var cds = [];
				var rds = [];
				$("input[name='checkbox']:checked").each(function(){
					cds.push($(this).val());
					rds.push($(this).data('reportid'));
		    	});
				var cid = cds.join(",");
				var rid = rds.join(",");
		    	var param = {report_id: rid,comment_id: cid};
				$.deleteNode("Report/delete", param, '确定要删除所选评论吗？', function (data) {
					if(data.status == 1){
						setParam();
					} else {
						layer.alert(data.msg);
						return false;
					}
				});
			});
		});

		var param = {token: $.ROOT.getItem("token"), type: 1};
		setParam();

		function setParam () {
			var title = $("input[name='keywords']").val() || '';
			var report_type = $("select[name='report_type']").val();
			param['title'] = title;
			param['report_type'] = report_type;
			return renderingPage();
		}

		function renderingPage(page){
			param['page'] = page || 1;
			$.ROOT.request("Report/list", param, function (data) {
				if($("#checkAll").prop("checked")){
					$("#checkAll").attr("checked", false);
				}
				if(data.status == 1){
					if(data.list.length > 0){
						$(".button-box").show();
						$("#checkAll").show();
						var pageNum = Math.ceil(data.count/10);
						$("#count").html("共"+pageNum+"页，"+data.count+"条");
				        //显示分页
				        laypage({
				            cont: 'page', //容器。值支持id名、原生dom对象，jquery对象。【如该容器为】：<div id="page1"></div>
				            pages: pageNum, //通过后台拿到的总页数
				            curr: page || 1, //当前页
				            skip: true, //是否开启跳页
				            jump: function(obj, first){ //触发分页后的回调
				                if(!first){ //点击跳页触发函数自身，并传递当前页：obj.curr
				                    renderingPage(obj.curr);
				                }
				            }
				        });
				        var gettpl = document.getElementById('artList').innerHTML;
						laytpl(gettpl).render(data, function(html){
						    document.getElementById('listBox').innerHTML = html;
						});
					} else {
						$(".button-box").hide();
						$("#checkAll").hide();
						$("#listBox").html('<tr><td colspan="9" align="center">暂无数据</td></tr>');
					}
				} else {
					layer.alert(data.msg);
					return false;
				}
			});
		};
	</script>
	<script src="/statics/js/plugins/layer/layer.min.js"></script>
</body>

</html>